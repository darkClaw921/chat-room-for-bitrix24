# Миграция TelegramUser - Добавление новых полей

## Описание
Миграция добавляет три новых поля в модель TelegramUser для расширения информации о клиентах:
- **additional_info** - Дополнительная информация о клиенте
- **deal_link** - Ссылка на сделку в CRM системе  
- **apartments** - Информация об аппартаментах

## Запуск миграции

### Способ 1: Через bash-скрипт (рекомендуется)
```bash
./run_migration.sh
```

### Способ 2: Прямой запуск Python скрипта
```bash
uv run migration_add_telegram_user_fields.py
```

## Что происходит при миграции

1. **Безопасное добавление полей** - используется `IF NOT EXISTS` для предотвращения ошибок при повторном запуске
2. **Логирование операций** - все действия записываются в лог с использованием loguru
3. **Автоматический коммит** - изменения сохраняются в базе данных автоматически
4. **Обработка ошибок** - при возникновении проблем выводится понятное сообщение

## Структура добавляемых полей

| Поле | Тип | Размер | Описание |
|------|-----|--------|----------|
| additional_info | TEXT | неограничен | Дополнительная информация о клиенте |
| deal_link | VARCHAR | 500 символов | Ссылка на сделку в CRM |
| apartments | VARCHAR | 200 символов | Информация об аппартаментах |

## Проверка результата

После успешного выполнения миграции новые поля будут доступны:
- В модели `app/models/user.py` (TelegramUser)
- В схемах `app/schemas/user.py` (TelegramUserBase, TelegramUserUpdate)
- В API эндпоинтах для работы с пользователями Telegram

## Откат миграции

Для отката миграции выполните SQL команды:
```sql
ALTER TABLE telegramuser DROP COLUMN IF EXISTS additional_info;
ALTER TABLE telegramuser DROP COLUMN IF EXISTS deal_link;
ALTER TABLE telegramuser DROP COLUMN IF EXISTS apartments;
``` 